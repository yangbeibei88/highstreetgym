{"version":3,"file":"src_components_TimetableSearchAndFilter_js.bundle.js","mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AAQA;AANA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AAEA;AAEA;AAmBA;AAyDA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAKA;AAEA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAAA;AAAA;;;;;;;;;;;;;;;;ACjJA;AAAA;AACA;AAEA;AAAA;AAEA;AAIA;AAAA;AACA;;;;;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AAEA;AAAA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AAEA;AAGA;AAIA;AAEA;AAIA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AASA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA","sources":["webpack://hsg_frontend/./src/components/FnPagination.js","webpack://hsg_frontend/./src/components/HTMLTemplate.js","webpack://hsg_frontend/./src/components/TimetableSearchAndFilter.js"],"sourcesContent":["export class Pagination {\n  constructor({\n    currentPage,\n    totalPages,\n    totalItems,\n    limit,\n    onPageChange,\n    paginationContainer,\n    captionContainer = \"\",\n  }) {\n    // console.log(\"Pagination Constructor:\", {\n    //   currentPage,\n    //   totalPages,\n    //   totalItems,\n    //   limit,\n    // });\n    this.currentPage = currentPage;\n    this.totalPages = totalPages;\n    this.totalItems = totalItems;\n    this.limit = limit;\n    this.onPageChange = onPageChange;\n    this._paginationContainer = document.querySelector(paginationContainer);\n    this._captionContainer = document.querySelector(captionContainer);\n  }\n\n  render() {\n    const startIndex =\n      this.totalItems > 0 ? (this.currentPage - 1) * this.limit + 1 : 0;\n    const endIndex = Math.min(this.currentPage * this.limit, this.totalItems);\n\n    const captionHtml = `\n        <!-- Showing X to Y of Z Entries -->\n      <span class=\"text-sm text-center text-darkCyan\">\n        Showing\n        <span class=\"font-semibold\">\n          ${startIndex}\n        </span>\n        to\n        <span class=\"font-semibold\">\n          ${endIndex}\n        </span>\n        of\n        <span class=\"font-semibold\">\n          ${this.totalItems}\n        </span>\n        Entries\n      </span>\n    `;\n\n    const paginationHtml = `<div class=\"block py-4\">\n    <div class=\"flex flex-col items-center justify-center md:flex-row md:justify-between\">\n    <!-- Showing X to Y of Z Entries -->\n      <span class=\"text-sm text-center text-darkCyan\">\n        Showing\n        <span class=\"font-semibold\">\n          ${startIndex}\n        </span>\n        to\n        <span class=\"font-semibold\">\n          ${endIndex}\n        </span>\n        of\n        <span class=\"font-semibold\">\n          ${this.totalItems}\n        </span>\n        Entries\n      </span>\n  \n      <!-- Pagination Controls -->\n      <nav aria-label=\"page navigation\">\n        <ul class=\"flex flex-wrap items-center -space-x-px h-8 text-sm\">\n          <!-- First Button -->\n          <li>\n            <a href=\"#\" data-page=\"1\" class=\"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-darkCyan bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-limeGreen ${this.currentPage === 1 ? \"cursor-not-allowed opacity-50\" : \"\"}\">\n              &laquo;&laquo; First\n            </a>\n          </li>\n  \n          <!-- Previous Button -->\n          <li>\n            <a href=\"#\" data-page=\"${this.currentPage - 1}\" class=\"flex items-center justify-center px-3 h-8 ms-0 leading-tight text-darkCyan bg-white border border-e-0 border-gray-300 hover:bg-limeGreen ${this.currentPage === 1 ? \"cursor-not-allowed opacity-50\" : \"\"}\">\n              &laquo; Prev\n            </a>\n          </li>\n  \n          <!-- Numbered Pages -->\n          ${this.renderPageNumbers()}\n  \n          <!-- Next Button -->\n          <li>\n            <a href=\"#\" data-page=\"${this.currentPage + 1}\" class=\"flex items-center justify-center px-3 h-8 leading-tight text-darkCyan bg-white border border-gray-300 hover:bg-limeGreen ${this.currentPage === this.totalPages || !this.totalPages ? \"cursor-not-allowed opacity-50\" : \"\"}\">\n              Next &raquo;\n            </a>\n          </li>\n  \n          <!-- Last Button -->\n          <li>\n            <a href=\"#\" data-page=\"${this.totalPages}\" class=\"flex items-center justify-center px-3 h-8 leading-tight text-darkCyan bg-white border border-gray-300 rounded-e-lg hover:bg-limeGreen ${this.currentPage === this.totalPages || !this.totalPages ? \"cursor-not-allowed opacity-50\" : \"\"}\">\n              Last &raquo;&raquo;\n            </a>\n          </li>\n        </ul>\n      </nav>\n    </div>\n  </div >`;\n\n    this._paginationContainer.innerHTML = paginationHtml;\n    this._captionContainer.innerHTML = captionHtml;\n\n    this.attachListeners();\n  }\n\n  renderPageNumbers() {\n    let pageNumbersHtml = \"\";\n    // eslint-disable-next-line no-plusplus\n    for (let i = 1; i <= this.totalPages; i++) {\n      pageNumbersHtml += `\n        <li>\n          <a href=\"#\" data-page=\"${i}\" class=\"flex items-center justify-center px-3 h-8 leading-tight text-darkCyan border border-gray-300 hover:bg-limeGreen ${this.currentPage === i ? \"bg-limeGreen\" : \"bg-white\"}\">${i}</a>\n        </li>\n      `;\n    }\n\n    return pageNumbersHtml;\n  }\n\n  attachListeners() {\n    const pageLinks =\n      this._paginationContainer.querySelectorAll(\"a[data-page]\");\n\n    pageLinks.forEach((link) => {\n      link.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        const page = parseInt(link.getAttribute(\"data-page\"), 10);\n\n        if (page >= 1 && page <= this.totalPages && page !== this.currentPage) {\n          this.onPageChange(page);\n        }\n      });\n    });\n  }\n\n  update(currentPage) {\n    this.currentPage = currentPage;\n    this.render();\n  }\n}\n","export const rowHtml = (field, value) =>\n  `<td data-cell=${field} class='grid grid-cols-2 before:content-[attr(data-cell)] before:uppercase before:font-semibold md:text-center md:table-cell md:before:content-none'>${value}</td>`;\n\nexport const linkHtml = (text, path) => `\n        <a href=\"${path}\" class=\"text-sm text-darkCyan underline underline-offset-2 decoration-dotted hover:brightness-125 hover:decoration-solid\">\n      ${text}\n    </a>\n    `;\n\nexport const avatarHtml = (path, alt) => `\n  <img class=\"size-10 rounded-full\" src=${path} alt=${alt} />\n`;\n","import { Pagination } from \"./FnPagination.js\";\nimport { rowHtml } from \"./HTMLTemplate.js\";\n\nexport class TimetableSearchAndFilter {\n  constructor() {\n    this._ttSearchAndFilterEl = document.getElementById(\"ttSearchAndFilter\");\n    this._classFilterEl = document.querySelector(\n      \"#ttSearchAndFilter #classFilter\",\n    );\n    this._fromDateEl = document.querySelector(\"#ttSearchAndFilter #fromDate\");\n    this._toDateEl = document.querySelector(\"#ttSearchAndFilter #toDate\");\n    this._timetableList = document.querySelector(\"table#timetableList tbody\");\n    this._myBookingTimetableIds = [];\n    this._paginationContainer = document.querySelector(\n      \"#pagination-container-timetable\",\n    );\n    this.pagination = null;\n    if (!this._ttSearchAndFilterEl || !this._timetableList) {\n      return;\n    }\n    this.handleSearchFilter();\n    this.initializeListeners();\n  }\n\n  initializeListeners() {\n    this._classFilterEl.addEventListener(\"change\", () =>\n      this.handleSearchFilter(),\n    );\n    this._fromDateEl.addEventListener(\"change\", () =>\n      this.handleSearchFilter(),\n    );\n    this._toDateEl.addEventListener(\"change\", () => this.handleSearchFilter());\n  }\n\n  buildQuery(page = 1, limit = 10) {\n    const classFilter = this._classFilterEl.value;\n    const fromDate = this._fromDateEl.value;\n    const toDate = this._toDateEl.value;\n\n    // eslint-disable-next-line node/no-unsupported-features/node-builtins\n    return new URLSearchParams({\n      classFilter: classFilter || \"\",\n      fromDate: fromDate || \"\",\n      toDate: toDate || \"\",\n      page,\n      limit,\n    }).toString();\n  }\n\n  async fetchTimetables(query) {\n    try {\n      const res = await fetch(`/timetable/search-filter?${query}`);\n      const data = await res.json();\n      this._myBookingTimetableIds = data.myBookingTimetableIds;\n      this.updateTimetableList(data.timetables);\n      // console.log(data.timetables);\n      this.updatePagination(data.pagination);\n    } catch (error) {\n      console.error(`Fetch timetable error: `, error);\n    }\n  }\n\n  handleSearchFilter(page = 1) {\n    const query = this.buildQuery(page);\n    this.fetchTimetables(query);\n  }\n\n  bookingButtonTemplate(timetableId, avail) {\n    const isDisabled =\n      this._myBookingTimetableIds.includes(timetableId) || !avail;\n    const href = isDisabled\n      ? \"#\"\n      : `/auth/account/timetable/${timetableId}/bookingForm`;\n    const classList = isDisabled\n      ? \"btn-bullet btn-limeGreen btn-sm cursor-not-allowed text-gray-600 saturate-50 hover:no-underline\"\n      : \"btn-bullet btn-limeGreen btn-sm\";\n\n    const buttonText = isDisabled ? \"Booked\" : \"Book Now\";\n\n    const btnUI = `<a href=\"${href}\" class=\"${classList}\">\n        ${buttonText}\n      </a>`;\n\n    return rowHtml(\"action\", btnUI);\n  }\n\n  updateTimetableList(timetables) {\n    this._timetableList.innerHTML = \"\";\n\n    if (timetables.length === 0) {\n      const row = document.createElement(\"tr\");\n      const noDataCell = document.createElement(\"td\");\n      noDataCell.colSpan = 9;\n      noDataCell.textContent = \"No class sessions found.\";\n      row.appendChild(noDataCell);\n      this._timetableList.appendChild(row);\n      return;\n    }\n\n    timetables.forEach((item) => {\n      const row = document.createElement(\"tr\");\n      row.innerHTML = `\n      ${rowHtml(\"date\", new Date(item.startDateTime).toLocaleDateString(\"en-AU\"))}\n      ${rowHtml(\"weekday\", new Date(item.startDateTime).toLocaleDateString(\"en-AU\", { weekday: \"short\" }))}\n      ${rowHtml(\"time\", new Date(item.startDateTime).toLocaleTimeString(\"en-AU\", { timeStyle: \"short\", hour12: false }))}\n      ${rowHtml(\"class\", item.className)}\n      ${rowHtml(\"duration\", item.duration)}\n      ${rowHtml(\"level\", item.level)}\n      ${rowHtml(\"trainer\", item.trainerFirstName)}\n      ${rowHtml(\"availability\", item.availability)}\n      ${this.bookingButtonTemplate(item.timetableId, item.availability)}\n      `;\n\n      this._timetableList.appendChild(row);\n    });\n  }\n\n  updatePagination(paginationData) {\n    // console.log(\"Fontend Pagination Data:\", paginationData);\n\n    // RE-NITIALIZE PAGINATION EVERYTIME NEW DATA IS FETCHED, OTHERWISE, THE PAGINATION NUMBERS WILL STAY AT THE FIRST TIME!\n    if (this.pagination) {\n      this._paginationContainer.innerHTML = \"\";\n    }\n\n    this.pagination = new Pagination({\n      currentPage: paginationData.currentPage,\n      totalPages: paginationData.totalPages,\n      totalItems: paginationData.totalItems,\n      limit: paginationData.limit,\n      onPageChange: (page) => {\n        this.handleSearchFilter(page);\n      },\n      paginationContainer: \"#pagination-container-timetable\",\n      captionContainer: \"table#timetableList caption\",\n    });\n\n    this.pagination.render();\n  }\n}\n"],"names":[],"sourceRoot":""}